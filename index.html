<!DOCTYPE html>
<html >
<head>

    <!--[if lt IE 9]>
        <style>body {display: none; background: none !important} </style>
        <meta http-equiv="Refresh" Content="0; url=//outdatedbrowser.com/" />
    <![endif]-->

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="format-detection" content="telephone=no" />
<meta name="author" content="虾米" />


    
    


<meta property="og:type" content="website">
<meta property="og:title" content="虾米笔记">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="虾米笔记">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="虾米笔记">

<link rel="apple-touch-icon" href= "/apple-touch-icon.png">


    <link rel="alternate" href="/atom.xml" title="虾米笔记" type="application/atom+xml">



    <link rel="shortcut icon" href="/favicon.png">



    <link href="//cdn.bootcss.com/animate.css/3.5.1/animate.min.css" rel="stylesheet">



    <link href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" rel="stylesheet">



    <script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
    <link href="//cdn.bootcss.com/pace/1.0.2/themes/blue/pace-theme-minimal.css" rel="stylesheet">


<link rel="stylesheet" href="/css/style.css">


    <style> .article { opacity: 0;} </style>


<link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">


<title>虾米笔记</title>

<script src="//cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>
<script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script>

<script>
    var yiliaConfig = {
        fancybox: true,
        animate: true,
        isHome: true,
        isPost: false,
        isArchive: false,
        isTag: false,
        isCategory: false,
        fancybox_js: "//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js",
        scrollreveal: "//cdn.bootcss.com/scrollReveal.js/3.1.4/scrollreveal.min.js",
        search: undefined
    }
</script>


    <script> yiliaConfig.jquery_ui = [false]; </script>



    <script> yiliaConfig.rootUrl = "\/";</script>






</head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
    <header id="header" class="inner">
        <a href="/" class="profilepic">
            <img src="/img/avatar.png" class="animated zoomIn">
        </a>
        <hgroup>
          <h1 class="header-author"><a href="/">虾米</a></h1>
        </hgroup>

        

        


        
            <div id="switch-btn" class="switch-btn">
                <div class="icon">
                    <div class="icon-ctn">
                        <div class="icon-wrap icon-house" data-idx="0">
                            <div class="birdhouse"></div>
                            <div class="birdhouse_holes"></div>
                        </div>
                        <div class="icon-wrap icon-ribbon hide" data-idx="1">
                            <div class="ribbon"></div>
                        </div>
                        
                        <div class="icon-wrap icon-link hide" data-idx="2">
                            <div class="loopback_l"></div>
                            <div class="loopback_r"></div>
                        </div>
                        
                        
                        <div class="icon-wrap icon-me hide" data-idx="3">
                            <div class="user"></div>
                            <div class="shoulder"></div>
                        </div>
                        
                    </div>
                    
                </div>
                <div class="tips-box hide">
                    <div class="tips-arrow"></div>
                    <ul class="tips-inner">
                        <li>菜单</li>
                        <li>标签</li>
                        
                        <li>友情链接</li>
                        
                        
                        <li>关于我</li>
                        
                    </ul>
                </div>
            </div>
        

        <div id="switch-area" class="switch-area">
            <div class="switch-wrap">
                <section class="switch-part switch-part1">
                    <nav class="header-menu">
                        <ul>
                        
                            <li><a href="/">主页</a></li>
                        
                            <li><a href="/archives/">所有文章</a></li>
                        
                            <li><a href="/tags/">标签云</a></li>
                        
                            <li><a href="/about/">关于我</a></li>
                        
                        </ul>
                    </nav>
                    <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" href="mailto:123@123.com" title="Email"></a>
                            
                                <a class="fa GitHub" href="#" title="GitHub"></a>
                            
                                <a class="fa RSS" href="/atom.xml" title="RSS"></a>
                            
                        </ul>
                    </nav>
                </section>
                
                
                <section class="switch-part switch-part2">
                    <div class="widget tagcloud" id="js-tagcloud">
                        <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/ClassLoader/">ClassLoader</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Drools/">Drools</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JVM/">JVM</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java/">Java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/">Linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Log4j2/">Log4j2</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Logstash/">Logstash</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MacOS/">MacOS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Maven/">Maven</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MySQL/">MySQL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Mysql/">Mysql</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Nginx/">Nginx</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/OSX/">OSX</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PostgreSQL/">PostgreSQL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Redis/">Redis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Spring/">Spring</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Ubuntu/">Ubuntu</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/iterm2/">iterm2</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/synchronized/">synchronized</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/多线程/">多线程</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/多线程，volatile/">多线程，volatile</a></li></ul>
                    </div>
                </section>
                
                
                
                <section class="switch-part switch-part3">
                    <div id="js-friends">
                    
                      <a class="main-nav-link switch-friends-link" href="https://hexo.io">Hexo</a>
                    
                      <a class="main-nav-link switch-friends-link" href="https://pages.github.com/">GitHub</a>
                    
                      <a class="main-nav-link switch-friends-link" href="http://moxfive.xyz/">MOxFIVE</a>
                    
                    </div>
                </section>
                

                
                
                <section class="switch-part switch-part4">
                
                    <div id="js-aboutme">专注于前端</div>
                </section>
                
            </div>
        </div>
    </header>                
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
      <div class="overlay">
          <div class="slider-trigger"></div>
          <h1 class="header-author js-mobile-header hide"><a href="/" title="回到主页">虾米</a></h1>
      </div>
    <div class="intrude-less">
        <header id="header" class="inner">
            <a href="/" class="profilepic">
                <img src="/img/avatar.png" class="animated zoomIn">
            </a>
            <hgroup>
              <h1 class="header-author"><a href="/" title="回到主页">虾米</a></h1>
            </hgroup>
            
            <nav class="header-menu">
                <ul>
                
                    <li><a href="/">主页</a></li>
                
                    <li><a href="/archives/">所有文章</a></li>
                
                    <li><a href="/tags/">标签云</a></li>
                
                    <li><a href="/about/">关于我</a></li>
                
                <div class="clearfix"></div>
                </ul>
            </nav>
            <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" target="_blank" href="mailto:123@123.com" title="Email"></a>
                            
                                <a class="fa GitHub" target="_blank" href="#" title="GitHub"></a>
                            
                                <a class="fa RSS" target="_blank" href="/atom.xml" title="RSS"></a>
                            
                        </ul>
            </nav>
        </header>                
    </div>
    <link class="menu-list" tags="标签" friends="友情链接" about="关于我"/>
</nav>
      <div class="body-wrap">
  
    <article id="post-Mysql数据类型取值范围" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2017/01/22/Mysql数据类型取值范围/" class="article-date">
      <time datetime="2017-01-22T13:54:56.000Z" itemprop="datePublished">2017-01-22</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/01/22/Mysql数据类型取值范围/">Mysql数据类型取值范围</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <table>
<thead>
<tr>
<th style="text-align:left">类型</th>
<th>范围</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">TINYINT</td>
<td>-128 ~ 128</td>
</tr>
<tr>
<td style="text-align:left">TINYINT UNSIGNED</td>
<td>0 ~ 255</td>
</tr>
<tr>
<td style="text-align:left">SMALLINT</td>
<td>-32768 ~ 32767</td>
</tr>
<tr>
<td style="text-align:left">SMALLINT UNSIGNED</td>
<td>0 ~ 65535</td>
</tr>
<tr>
<td style="text-align:left">MEDIUMINT</td>
<td>-8388608 ~ 8388607</td>
</tr>
<tr>
<td style="text-align:left">MEDIUMINT UNSIGNED</td>
<td>0 ~ 16777215</td>
</tr>
<tr>
<td style="text-align:left">INT</td>
<td>-2147483648 ~ 2147483647</td>
</tr>
<tr>
<td style="text-align:left">INT UNSIGNED</td>
<td>0 ~ 4294967295</td>
</tr>
<tr>
<td style="text-align:left">BIGINT</td>
<td>-9223372036854775808 ~ 9223372036854775808</td>
</tr>
<tr>
<td style="text-align:left">BIGINT UNSIGNED</td>
<td>0 ~ 18446744073709551615</td>
</tr>
<tr>
<td style="text-align:left">FLOAT</td>
<td>-3.402823466E+38 ~ -1.175494351E-38,0,1.175494351E-38 ~ 3.402823466E+38</td>
</tr>
<tr>
<td style="text-align:left">DOUBLE</td>
<td>-1.7976931348623157E+308 ~ -2.2250738585072014E-308,0,2.2250738585072014E-308 ~ 1.7976931348623157E+308</td>
</tr>
<tr>
<td style="text-align:left">DATE</td>
<td>1000-01-01 ~ 9999-12-31</td>
</tr>
<tr>
<td style="text-align:left">DATETIME</td>
<td>1000-01-01 00:00:00 ~ 9999-12-31 23:59:59</td>
</tr>
<tr>
<td style="text-align:left">TIMESTAMP</td>
<td>1970-01-01 00:00:01UTC ~ 2038/01/19 3:14:07UTC</td>
</tr>
<tr>
<td style="text-align:left">TIME</td>
<td>-838:59:59’ ~ 838:59:59’</td>
</tr>
<tr>
<td style="text-align:left">YEAR(2 or 4)</td>
<td>缺省为4位格式,4位格式取值范围为1901 - 2155,0000,2位格式取值范围为70-69(1970-2069)</td>
</tr>
<tr>
<td style="text-align:left">CHAR</td>
<td>1 ~ 255</td>
</tr>
<tr>
<td style="text-align:left">VARCHAR</td>
<td>65535</td>
</tr>
</tbody>
</table>

      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MySQL/">MySQL</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-Drools语法" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/11/16/Drools语法/" class="article-date">
      <time datetime="2016-11-16T03:29:55.000Z" itemprop="datePublished">2016-11-16</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/11/16/Drools语法/">Drools语法</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h3 id="DRL文件结构"><a href="#DRL文件结构" class="headerlink" title="DRL文件结构"></a>DRL文件结构</h3><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"># 逻辑上的包名, 与物理位置无关</div><div class="line">package a.b.c</div><div class="line"></div><div class="line"># 需要导入的类名和类静态方法</div><div class="line">import a.b.Class</div><div class="line">import a.b.Class.method # </div><div class="line"></div><div class="line"># 定义全局变量</div><div class="line">global variable</div><div class="line"></div><div class="line"># 定义函数</div><div class="line">function funcitonName</div><div class="line"></div><div class="line"># 定义查询</div><div class="line">query queryName</div><div class="line"></div><div class="line"># 定义规则</div><div class="line">rule</div></pre></td></tr></table></figure>
      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Drools/">Drools</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-MySQL查询优化-Explain-解释" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/11/14/MySQL查询优化-Explain-解释/" class="article-date">
      <time datetime="2016-11-14T06:51:51.000Z" itemprop="datePublished">2016-11-14</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/11/14/MySQL查询优化-Explain-解释/">MySQL查询优化(Explain)解释</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
              <p><strong>id</strong>: 一条查询语句可能会有子查询或连接查询，这列代表序号，多条语句的执行顺序</p>
<p><strong>select_type</strong>: SQL语句的select类型，它有以下几种值：</p>
<ul>
<li><strong>SIMPLE</strong>: 简单查询，它表示简单的select语句，没有union和子查询。</li>
<li><strong>PRIMARY</strong>: 查询，最外面的select，在有子查询的语句中，最外面的select查询就是primary。</li>
<li><strong>SUBQUERY</strong>: 嵌套查询中的子查询。</li>
<li><strong>DERIVED</strong>: 把select语句的结果当做虚表，作为<code>FROM</code>子句再次查询的。</li>
<li><strong>UNION</strong>: 联合查询，union语句的第二个或者说是后面那一个。</li>
<li><strong>UNION RESULT</strong>: 使用union查询后，自动产生的连接语句。</li>
<li><strong>DEPENDENT UNION</strong>: union中的第二个或后面的SELECT语句，取决于外面的查询。</li>
</ul>
<p><strong>table</strong>: 显示这一行的数据是关于哪张表的。</p>
          
      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Mysql/">Mysql</a></li></ul>
    </div>

      
        <p class="article-more-link">
          <a href="/2016/11/14/MySQL查询优化-Explain-解释/#more">more >></a>
        </p>
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-Java的BIO-NIO-AIO" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/11/09/Java的BIO-NIO-AIO/" class="article-date">
      <time datetime="2016-11-09T13:29:07.000Z" itemprop="datePublished">2016-11-09</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/11/09/Java的BIO-NIO-AIO/">Java的BIO,NIO,AIO</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p>阻塞: 进程/线程要访问的数据没有就绪，进程/线程需要等待；<br>非阻塞: 进程/线程要访问的数据没有就绪，函数马上返回，进程/线程不需要等待；</p>
<p>同步: 访问数据的方式，同步需要主动读写数据；<br>异步: 异步只需要I/O操作完成的通知，并不主动读写数据，由操作系统内核完成数据的读写。</p>
<h4 id="Java对BIO、NIO、AIO的支持"><a href="#Java对BIO、NIO、AIO的支持" class="headerlink" title="Java对BIO、NIO、AIO的支持:"></a>Java对BIO、NIO、AIO的支持:</h4><p>Java BIO: 同步并阻塞，服务器实现模式为一个连接一个线程，即客户端有连接请求时服务器端就需要启动一个线程进行处理，如果这个连接不做任何事情会造成不必要的线程开销，当然可以通过线程池机制改善。<br>适用于连接数目比较小且固定的架构，这种方式对服务器资源要求比较高，并发局限于应用中，JDK1.4以前的唯一选择，但程序直观简单易理解。</p>
<p>Java NIO: 同步非阻塞，服务器实现模式为一个请求一个线程，即客户端发送的连接请求都会注册到多路复用器上，多路复用器轮询到连接有I/O请求时才启动一个线程进行处理。<br>适用于连接数目多且连接比较短（轻操作）的架构，比如聊天服务器，并发局限于应用中，编程比较复杂，JDK1.4开始支持。</p>
<p>Java AIO(NIO.2): 异步非阻塞，服务器实现模式为一个有效请求一个线程，客户端的I/O请求都是由OS先完成了再通知服务器应用去启动线程进行处理。<br>适用于连接数目多且连接比较长（重操作）的架构，比如相册服务器，充分调用OS参与并发操作，编程比较复杂，JDK7开始支持。</p>
<h3 id="实现原理"><a href="#实现原理" class="headerlink" title="实现原理"></a>实现原理</h3><p>按照《Unix网络编程》的划分，IO模型可以分为：阻塞IO、非阻塞IO、IO复用、信号驱动IO和异步IO，按照POSIX标准来划分只分为两类：同步IO和异步IO。<br>如何区分呢？首先一个IO操作其实分成了两个步骤：发起IO请求和实际的IO操作，同步IO和异步IO的区别就在于第二个步骤是否阻塞，如果实际的IO读写阻塞请求进程，那么就是同步IO，因此阻塞IO、非阻塞IO、IO复用、信号驱动IO都是同步IO，如果不阻塞，而是操作系统帮你做完IO操作再将结果返回给你，那么就是异步IO。阻塞IO和非阻塞IO的区别在于第一步，发起IO请求是否会被阻塞，如果阻塞直到完成那么就是传统的阻塞IO，如果不阻塞，那么就是非阻塞IO。</p>
<p>POSIX标准来划分只分为两类：同步IO和异步IO。<br>如何区分呢？首先一个IO操作其实分成了两个步骤：发起IO请求和实际的IO操作，同步IO和异步IO的区别就在于第二个步骤是否阻塞，如果实际的IO读写阻塞请求进程，那么就是同步IO，因此阻塞IO、非阻塞IO、IO复用、信号驱动IO都是同步IO，如果不阻塞，而是操作系统帮你做完IO操作再将结果返回给你，那么就是异步IO。阻塞IO和非阻塞IO的区别在于第一步，发起IO请求是否会被阻塞，如果阻塞直到完成那么就是传统的阻塞IO，如果不阻塞，那么就是非阻塞IO。</p>
<p>Java NIO中的FileChannel.transferTo()方法都实现了零拷贝</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-JVM垃圾回收" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/11/01/JVM垃圾回收/" class="article-date">
      <time datetime="2016-11-01T06:51:28.000Z" itemprop="datePublished">2016-11-01</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/11/01/JVM垃圾回收/">JVM垃圾回收</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h3 id="垃圾回收算法"><a href="#垃圾回收算法" class="headerlink" title="垃圾回收算法"></a>垃圾回收算法</h3><h4 id="引用计数法-Reference-Counting"><a href="#引用计数法-Reference-Counting" class="headerlink" title="引用计数法 (Reference Counting)"></a>引用计数法 (Reference Counting)</h4><p>引用计数器的实现很简单，对于一个对象 A，只要有任何一个对象引用了 A，则 A 的引用计数器就加 1，当引用失效时，引用计数器就减 1。只要对象 A 的引用计数器的值为 0，则对象 A 就不可能再被使用。<br>引用计数器的实现也非常简单，只需要为每个对象配置一个整形的计数器即可。但是引用计数器有一个严重的问题，即无法处理循环引用的情况。因此，在 Java 的垃圾回收器中没有使用这种算法。</p>
<p>一个简单的循环引用问题描述如下：有对象 A 和对象 B，对象 A 中含有对象 B 的引用，对象 B 中含有对象 A 的引用。此时，对象 A 和对象 B 的引用计数器都不为 0。但是在系统中却不存在任何第 3 个对象引用了 A 或 B。也就是说，A 和 B 是应该被回收的垃圾对象，但由于垃圾对象间相互引用，从而使垃圾回收器无法识别，引起内存泄漏。</p>
<h4 id="标记-清除算法-Mark-Sweep"><a href="#标记-清除算法-Mark-Sweep" class="headerlink" title="标记-清除算法 (Mark-Sweep)"></a>标记-清除算法 (Mark-Sweep)</h4><p>标记-清除算法将垃圾回收分为两个阶段：标记阶段和清除阶段。一种可行的实现是，在标记阶段首先通过根节点，标记所有从根节点开始的较大对象。因此，未被标记的对象就是未被引用的垃圾对象。然后，在清除阶段，清除所有未被标记的对象。该算法最大的问题是存在大量的空间碎片，因为回收后的空间是不连续的。在对象的堆空间分配过程中，尤其是大对象的内存分配，不连续的内存空间的工作效率要低于连续的空间。</p>
<h4 id="复制算法-Copying"><a href="#复制算法-Copying" class="headerlink" title="复制算法 (Copying)"></a>复制算法 (Copying)</h4><p>将现有的内存空间分为两快，每次只使用其中一块，在垃圾回收时将正在使用的内存中的存活对象复制到未被使用的内存块中，之后，清除正在使用的内存块中的所有对象，交换两个内存的角色，完成垃圾回收。<br>如果系统中的垃圾对象很多，复制算法需要复制的存活对象数量并不会太大。因此在真正需要垃圾回收的时刻，复制算法的效率是很高的。又由于对象在垃圾回收过程中统一被复制到新的内存空间中，因此，可确保回收后的内存空间是没有碎片的。该算法的缺点是将系统内存折半。<br>Java 的新生代串行垃圾回收器中使用了复制算法的思想。新生代分为 eden 空间、from 空间、to 空间 3 个部分。其中 from 空间和 to 空间可以视为用于复制的两块大小相同、地位相等，且可进行角色互换的空间块。from 和 to 空间也称为 survivor 空间，即幸存者空间，用于存放未被回收的对象。<br>在垃圾回收时，eden 空间中的存活对象会被复制到未使用的 survivor 空间中 (假设是 to)，正在使用的 survivor 空间 (假设是 from) 中的年轻对象也会被复制到 to 空间中 (大对象，或者老年对象会直接进入老年带，如果 to 空间已满，则对象也会直接进入老年代)。此时，eden 空间和 from 空间中的剩余对象就是垃圾对象，可以直接清空，to 空间则存放此次回收后的存活对象。这种改进的复制算法既保证了空间的连续性，又避免了大量的内存空间浪费。</p>
<h4 id="标记-压缩算法-Mark-Compact"><a href="#标记-压缩算法-Mark-Compact" class="headerlink" title="标记-压缩算法 (Mark-Compact)"></a>标记-压缩算法 (Mark-Compact)</h4><p>复制算法的高效性是建立在存活对象少、垃圾对象多的前提下的。这种情况在年轻代经常发生，但是在老年代更常见的情况是大部分对象都是存活对象。如果依然使用复制算法，由于存活的对象较多，复制的成本也将很高。<br>标记-压缩算法是一种老年代的回收算法，它在标记-清除算法的基础上做了一些优化。也首先需要从根节点开始对所有可达对象做一次标记，但之后，它并不简单地清理未标记的对象，而是将所有的存活对象压缩到内存的一端。之后，清理边界外所有的空间。这种方法既避免了碎片的产生，又不需要两块相同的内存空间，因此，其性价比比较高。</p>
<h4 id="增量算法-Incremental-Collecting"><a href="#增量算法-Incremental-Collecting" class="headerlink" title="增量算法 (Incremental Collecting)"></a>增量算法 (Incremental Collecting)</h4><p>在垃圾回收过程中，应用软件将处于一种 CPU 消耗很高的状态。在这种 CPU 消耗很高的状态下，应用程序所有的线程都会挂起，暂停一切正常的工作，等待垃圾回收的完成。如果垃圾回收时间过长，应用程序会被挂起很久，将严重影响用户体验或者系统的稳定性。<br>增量算法的基本思想是，如果一次性将所有的垃圾进行处理，需要造成系统长时间的停顿，那么就可以让垃圾收集线程和应用程序线程交替执行。每次，垃圾收集线程只收集一小片区域的内存空间，接着切换到应用程序线程。依次反复，直到垃圾收集完成。使用这种方式，由于在垃圾回收过程中，间断性地还执行了应用程序代码，所以能减少系统的停顿时间。但是，因为线程切换和上下文转换的消耗，会使得垃圾回收的总体成本上升，造成系统吞吐量的下降。</p>
<h4 id="分代-Generational-Collecting"><a href="#分代-Generational-Collecting" class="headerlink" title="分代 (Generational Collecting)"></a>分代 (Generational Collecting)</h4><p>根据垃圾回收对象的特性，不同阶段最优的方式是使用合适的算法用于本阶段的垃圾回收，分代算法即是基于这种思想，它将内存区间根据对象的特点分成几块，根据每块内存区间的特点，使用不同的回收算法，以提高垃圾回收的效率。以 Hot Spot 虚拟机为例，它将所有的新建对象都放入称为年轻代的内存区域，年轻代的特点是对象会很快回收，因此，在年轻代就选择效率较高的复制算法。当一个对象经过几次回收后依然存活，对象就会被放入称为老生代的内存空间。在老生代中，几乎所有的对象都是经过几次垃圾回收后依然得以幸存的。因此，可以认为这些对象在一段时期内，甚至在应用程序的整个生命周期中，将是常驻内存的。如果依然使用复制算法回收老生代，将需要复制大量对象。再加上老生代的回收性价比也要低于新生代，因此这种做法也是不可取的。根据分代的思想，可以对老年代的回收使用与新生代不同的标记-压缩算法，以提高垃圾回收效率。</p>
<h3 id="从不同角度分析垃圾收集器，可以将其分为不同的类型。"><a href="#从不同角度分析垃圾收集器，可以将其分为不同的类型。" class="headerlink" title="从不同角度分析垃圾收集器，可以将其分为不同的类型。"></a>从不同角度分析垃圾收集器，可以将其分为不同的类型。</h3><ol>
<li>按线程数分，可以分为串行垃圾回收器和并行垃圾回收器。串行垃圾回收器一次只使用一个线程进行垃圾回收；并行垃圾回收器一次将开启多个线程同时进行垃圾回收。在并行能力较强的 CPU 上，使用并行垃圾回收器可以缩短 GC 的停顿时间。</li>
<li>按照工作模式分，可以分为并发式垃圾回收器和独占式垃圾回收器。并发式垃圾回收器与应用程序线程交替工作，以尽可能减少应用程序的停顿时间；独占式垃圾回收器 (Stop the world) 一旦运行，就停止应用程序中的其他所有线程，直到垃圾回收过程完全结束。</li>
<li>按碎片处理方式可分为压缩式垃圾回收器和非压缩式垃圾回收器。压缩式垃圾回收器会在回收完成后，对存活对象进行压缩整理，消除回收后的碎片；非压缩式的垃圾回收器不进行这步操作。</li>
<li>按工作的内存区间，又可分为新生代垃圾回收器和老年代垃圾回收器。</li>
</ol>
<p>可以用以下指标评价一个垃圾处理器的好坏。<br>吞吐量：指在应用程序的生命周期内，应用程序所花费的时间和系统总运行时间的比值。系统总运行时间=应用程序耗时+GC 耗时。如果系统运行了 100min，GC 耗时 1min，那么系统的吞吐量就是 (100-1)/100=99%。<br>垃圾回收器负载：和吞吐量相反，垃圾回收器负载指来记回收器耗时与系统运行总时间的比值。<br>停顿时间：指垃圾回收器正在运行时，应用程序的暂停时间。对于独占回收器而言，停顿时间可能会比较长。使用并发的回收器时，由于垃圾回收器和应用程序交替运行，程序的停顿时间会变短，但是，由于其效率很可能不如独占垃圾回收器，故系统的吞吐量可能会较低。<br>垃圾回收频率：指垃圾回收器多长时间会运行一次。一般来说，对于固定的应用而言，垃圾回收器的频率应该是越低越好。通常增大堆空间可以有效降低垃圾回收发生的频率，但是可能会增加回收产生的停顿时间。<br>反应时间：指当一个对象被称为垃圾后多长时间内，它所占据的内存空间会被释放。<br>堆分配：不同的垃圾回收器对堆内存的分配方式可能是不同的。一个良好的垃圾收集器应该有一个合理的堆内存区间划分。</p>
<h3 id="JVM-垃圾回收器分类"><a href="#JVM-垃圾回收器分类" class="headerlink" title="JVM 垃圾回收器分类"></a>JVM 垃圾回收器分类</h3><h4 id="新生代串行收集器"><a href="#新生代串行收集器" class="headerlink" title="新生代串行收集器"></a>新生代串行收集器</h4><p>串行收集器主要有两个特点：第一，它仅仅使用单线程进行垃圾回收；第二，它独占式的垃圾回收。<br>在串行收集器进行垃圾回收时，Java 应用程序中的线程都需要暂停，等待垃圾回收的完成，这样给用户体验造成较差效果。虽然如此，串行收集器却是一个成熟、经过长时间生产环境考验的极为高效的收集器。新生代串行处理器使用复制算法，实现相对简单，逻辑处理特别高效，且没有线程切换的开销。在诸如单 CPU 处理器或者较小的应用内存等硬件平台不是特别优越的场合，它的性能表现可以超过并行回收器和并发回收器。在 HotSpot 虚拟机中，使用-XX：+UseSerialGC 参数可以指定使用新生代串行收集器和老年代串行收集器。</p>
<h4 id="老年代串行收集器"><a href="#老年代串行收集器" class="headerlink" title="老年代串行收集器"></a>老年代串行收集器</h4><p>老年代串行收集器使用的是标记-压缩算法。和新生代串行收集器一样，它也是一个串行的、独占式的垃圾回收器。由于老年代垃圾回收通常会使用比新生代垃圾回收更长的时间，因此，在堆空间较大的应用程序中，一旦老年代串行收集器启动，应用程序很可能会因此停顿几秒甚至更长时间。虽然如此，老年代串行回收器可以和多种新生代回收器配合使用，同时它也可以作为 CMS 回收器的备用回收器。若要启用老年代串行回收器，可以尝试使用以下参数：-XX:+UseSerialGC: 新生代、老年代都使用串行回收器。</p>
<h4 id="并行收集器"><a href="#并行收集器" class="headerlink" title="并行收集器"></a>并行收集器</h4><p>并行收集器是工作在新生代的垃圾收集器，它只简单地将串行回收器多线程化。它的回收策略、算法以及参数和串行回收器一样。<br>并行回收器也是独占式的回收器，在收集过程中，应用程序会全部暂停。但由于并行回收器使用多线程进行垃圾回收，因此，在并发能力比较强的 CPU 上，它产生的停顿时间要短于串行回收器，而在单 CPU 或者并发能力较弱的系统中，并行回收器的效果不会比串行回收器好，由于多线程的压力，它的实际表现很可能比串行回收器差。</p>
<h4 id="新生代并行回收-Parallel-Scavenge-收集器"><a href="#新生代并行回收-Parallel-Scavenge-收集器" class="headerlink" title="新生代并行回收 (Parallel Scavenge) 收集器"></a>新生代并行回收 (Parallel Scavenge) 收集器</h4><p>新生代并行回收收集器也是使用复制算法的收集器。从表面上看，它和并行收集器一样都是多线程、独占式的收集器。但是，并行回收收集器有一个重要的特点：它非常关注系统的吞吐量。</p>
<h4 id="老年代并行回收收集器"><a href="#老年代并行回收收集器" class="headerlink" title="老年代并行回收收集器"></a>老年代并行回收收集器</h4><p>老年代的并行回收收集器也是一种多线程并发的收集器。和新生代并行回收收集器一样，它也是一种关注吞吐量的收集器。老年代并行回收收集器使用标记-压缩算法</p>
<h4 id="CMS收集器"><a href="#CMS收集器" class="headerlink" title="CMS收集器"></a>CMS收集器</h4><p>与并行回收收集器不同，CMS 收集器主要关注于系统停顿时间。CMS 是 Concurrent Mark Sweep 的缩写，意为并发标记清除，从名称上可以得知，它使用的是标记-清除算法，同时它又是一个使用多线程并发回收的垃圾收集器。</p>
<p><strong>eden满了minor gc，升到老年代的对象大于老年代剩余空间full gc，或者小于时被HandlePromotionFailure参数强制full gc；gc与非gc时间耗时超过了GCTimeRatio的限制引发OOM，调优诸如通过NewRatio控制新生代老年代比例，通过MaxTenuringThreshold控制进入老年前生存次数等……能回答道这个阶段就会给我带来比较高的期望了，当然面试的时候正常人都不会记得每个参数的拼写，我自己写这段话的时候也是翻过手册的。回答道这部分的小于2%。 
</strong></p>
<p>-XX:+UseSerialGC: 新生代、老年代都使用串行回收器<br>-XX:+UseParNewGC: 新生代使用并行收集器，老年代使用串行收集器<br>-XX:+UseParallelGC: 新生代使用并行回收收集器，老年代使用串行收集器<br>-XX:+UseParallelOldGC: 新生代和老年代都是用并行回收收集器<br>-XX:ParallelGCThreads: 指定并行收集器工作时的线程数量<br>-XX:ParallelCMSThreads: 参数手工设定 CMS 的线程数量</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-Java5-6-7区别" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/11/01/Java5-6-7区别/" class="article-date">
      <time datetime="2016-11-01T06:39:29.000Z" itemprop="datePublished">2016-11-01</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/11/01/Java5-6-7区别/">Java5,6,7区别</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        
      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-JVM类加载机制" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/08/12/JVM类加载机制/" class="article-date">
      <time datetime="2016-08-12T08:04:34.000Z" itemprop="datePublished">2016-08-12</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/08/12/JVM类加载机制/">JVM类加载机制</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h3 id="什么是类加载器"><a href="#什么是类加载器" class="headerlink" title="什么是类加载器"></a>什么是类加载器</h3><p><strong> 类加载器(ClassLoader) </strong> 是一个用来加载 class 的对象。给定一个 class 二进制名称，类加载器需要定位或者生成能够描述这个 class 的结构信息（方法、常量池等等）。</p>
<h3 id="体系结构"><a href="#体系结构" class="headerlink" title="体系结构"></a>体系结构</h3><div align="center"><br><img src="http://7xlm7s.com1.z0.glb.clouddn.com/ClassLoader%E4%BD%93%E7%B3%BB.png?imageView2/2/w/500/h/300&amp;v=20160812" alt="JVM内存区域划分"><br></div>

<h3 id="java-lang-ClassLoader-介绍"><a href="#java-lang-ClassLoader-介绍" class="headerlink" title="java.lang.ClassLoader 介绍"></a>java.lang.ClassLoader 介绍</h3><p><strong> java.lang.ClassLoader </strong> 是一个抽象类，里面定义了以下几个核心方法</p>
<table>
<thead>
<tr>
<th style="text-align:left">ClassLoader</th>
<th style="text-align:left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">public final ClassLoader getParent()</td>
<td style="text-align:left">返回父级 ClassLoader 对象</td>
</tr>
<tr>
<td style="text-align:left">public Class&lt;?&gt; loadClass(String name)</td>
<td style="text-align:left">加载名称为 name 的类</td>
</tr>
<tr>
<td style="text-align:left">protected Class&lt;?&gt; findClass(String name)</td>
<td style="text-align:left">查找名称为 name 的类</td>
</tr>
<tr>
<td style="text-align:left">protected final Class&lt;?&gt; findLoadedClass(String name)</td>
<td style="text-align:left">查找已经当前被加载器加载过的类</td>
</tr>
<tr>
<td style="text-align:left">protected final Class&lt;?&gt; defineClass(String name, byte[] b,<br>int off, int len, ProtectionDomain protectionDomain)</td>
<td style="text-align:left">findClass 找到指定的类后，通过调用 defineClass 方法将byte字节流解析成JVM能够识别的Class对象</td>
</tr>
<tr>
<td style="text-align:left">protected final void resolveClass(Class&lt;?&gt; c)</td>
<td style="text-align:left">链接指定的类</td>
</tr>
</tbody>
</table>
<p>通过 findClass 和 defineClass 方法，我们不仅可以通过 Class 文件获取实例化对象，还可以通过各种其他渠道获取(HTTP、FTP、RPC 等等)</p>
<h3 id="Java-中默认的类加载器层级关系"><a href="#Java-中默认的类加载器层级关系" class="headerlink" title="Java 中默认的类加载器层级关系"></a>Java 中默认的类加载器层级关系</h3><h4 id="Java-内置三个类加载器"><a href="#Java-内置三个类加载器" class="headerlink" title="Java 内置三个类加载器"></a>Java 内置三个类加载器</h4><table>
<thead>
<tr>
<th style="text-align:left">ClassLoader</th>
<th style="text-align:left">上级加载器</th>
<th style="text-align:left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">启动类加载器(Bootstrap ClassLoader)</td>
<td style="text-align:left">null</td>
<td style="text-align:left">C实现，加载${JRE_HOME}/lib/rt.jar以及为-Xbootclasspath所指定的目录下的类库</td>
</tr>
<tr>
<td style="text-align:left">扩展类加载器(ExtClassLoader)</td>
<td style="text-align:left">Bootstrap</td>
<td style="text-align:left">加载${JRE_HOME}/lib/ext或者java.ext.dirs指向的目录</td>
</tr>
<tr>
<td style="text-align:left">应用程序类加载器(AppClassLoader)</td>
<td style="text-align:left">ExtClassLoader</td>
<td style="text-align:left">加载由-classpath或-cp选项定义，或者是JAR中的Manifest的classpath属性定义指向的目录</td>
</tr>
</tbody>
</table>
<p>运行如下代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Test</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getClassLoaderHierarchy</span><span class="params">()</span> </span>&#123;</div><div class="line">    System.out.println(ClassLoader.getSystemClassLoader());</div><div class="line">    System.out.println(ClassLoader.getSystemClassLoader().getParent());</div><div class="line">    System.out.println(ClassLoader.getSystemClassLoader().getParent().getParent());</div><div class="line"></div><div class="line">    <span class="comment">// 输出结果</span></div><div class="line">    <span class="comment">// sun.misc.Launcher$AppClassLoader@14ae5a5</span></div><div class="line">    <span class="comment">// sun.misc.Launcher$ExtClassLoader@77a567e1</span></div><div class="line">    <span class="comment">// null</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>证明 AppClassLoader =&gt; ExtClassLoader, 因为 Bootstrap ClassLoader 是用原生代码(C)实现的，并不继承 <strong> java.lang.ClassLoader </strong>，所以 这里输出为 null</p>
<h3 id="委托机制"><a href="#委托机制" class="headerlink" title="委托机制"></a>委托机制</h3><p>看下 <strong> java.lang.ClassLoader#loadClass </strong> 的源码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">protected</span> Class&lt;?&gt; loadClass(String name, <span class="keyword">boolean</span> resolve)</div><div class="line">        <span class="keyword">throws</span> ClassNotFoundException</div><div class="line">&#123;</div><div class="line">    <span class="keyword">synchronized</span> (getClassLoadingLock(name)) &#123;</div><div class="line">        <span class="comment">// 首先判断类是否被加载</span></div><div class="line">        Class&lt;?&gt; c = findLoadedClass(name);</div><div class="line">        <span class="keyword">if</span> (c == <span class="keyword">null</span>) &#123;</div><div class="line">            <span class="keyword">long</span> t0 = System.nanoTime();</div><div class="line">            <span class="keyword">try</span> &#123;</div><div class="line">                <span class="keyword">if</span> (parent != <span class="keyword">null</span>) &#123; <span class="comment">// 父类加载器不为空，委托父类加载器进行加载</span></div><div class="line">                    c = parent.loadClass(name, <span class="keyword">false</span>);</div><div class="line">                &#125; <span class="keyword">else</span> &#123; <span class="comment">// 不存在父类加载器(根据内置定义好的加载器调用关系，ExtClassLoader 不存在父类加载器)，直接调用 Bootstrap ClassLoader 进行加载</span></div><div class="line">                    c = findBootstrapClassOrNull(name);</div><div class="line">                &#125;</div><div class="line">            &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</div><div class="line">                <span class="comment">// ClassNotFoundException thrown if class not found</span></div><div class="line">                <span class="comment">// from the non-null parent class loader</span></div><div class="line">            &#125;</div><div class="line"></div><div class="line">            <span class="keyword">if</span> (c == <span class="keyword">null</span>) &#123;</div><div class="line">                <span class="comment">// 如果仍然找不到，调用自己的 findClass 方法加载</span></div><div class="line">                <span class="keyword">long</span> t1 = System.nanoTime();</div><div class="line">                c = findClass(name);</div><div class="line"></div><div class="line">                <span class="comment">// this is the defining class loader; record the stats</span></div><div class="line">                sun.misc.PerfCounter.getParentDelegationTime().addTime(t1 - t0);</div><div class="line">                sun.misc.PerfCounter.getFindClassTime().addElapsedTimeFrom(t1);</div><div class="line">                sun.misc.PerfCounter.getFindClasses().increment();</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (resolve) &#123;</div><div class="line">            resolveClass(c);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> c;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>可以看出，类加载器在接到加载类的请求时，首先将加载任务委托给父类加载器，依次递归，如果父类加载器可以完成类加载任务，就成功返回；只有父类加载器无法完成此加载任务时，才自己去加载。<em>(当然，这是系统默认的实现机制，我们也可以实现自己的类加载器重写这个方法，tomcat 的应用隔离就使用了这种方式)</em></p>
<h4 id="委托机制的意义"><a href="#委托机制的意义" class="headerlink" title="委托机制的意义"></a>委托机制的意义</h4><ol>
<li>可以避免重复加载，当父类已经加载了该类的时候就没有必要子ClassLoader再加载一次；</li>
<li>考虑到安全因素，如果不使用这种委托模式，那么可以随时使用自定义的Class来动态代替Java核心API中定义的类型，这样做会存在非常大的安全隐患，而父类委托模式就可以避免这种情况，因为服加载器已经在启动时被加载</li>
</ol>
<h3 id="可见性机制"><a href="#可见性机制" class="headerlink" title="可见性机制"></a>可见性机制</h3><p>子类加载器可以看到父类加载器加载的类，而反之则不行。所以下面的例子中，当 ClassLoaderTest.class 已经被 AppClassLoader 类加载器加载过了，然后如果想要使用 ExtClassLoader 类加载器加载这个类，将会抛出 java.lang.ClassNotFoundException 异常。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> net.sephy.test;</div><div class="line"><span class="keyword">import</span> org.junit.Test;</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ClassLoaderTest</span> </span>&#123;</div><div class="line">    <span class="meta">@Test</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            ClassLoader classLoader = ClassLoaderTest.class.getClassLoader();</div><div class="line">            <span class="comment">// printing ClassLoader of this class</span></div><div class="line">            System.out.println(<span class="string">"ClassLoaderTest.getClass().getClassLoader(): "</span> + classLoader);</div><div class="line">            <span class="comment">// 调用其他类加载器强行加载这个类</span></div><div class="line">            Class.forName(<span class="string">"test.ClassLoaderTest"</span>, <span class="keyword">true</span>, classLoader.getParent());</div><div class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException ex) &#123;</div><div class="line">            ex.printStackTrace();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">// 输出</span></div><div class="line"><span class="comment">// ClassLoaderTest.getClass().getClassLoader(): sun.misc.Launcher$AppClassLoader@14ae5a5</span></div><div class="line"><span class="comment">// java.lang.ClassNotFoundException: net.sephy.test.ClassLoaderTest</span></div><div class="line"><span class="comment">//	   at java.net.URLClassLoader$1.run(URLClassLoader.java:372)</span></div><div class="line"><span class="comment">//	   at java.net.URLClassLoader$1.run(URLClassLoader.java:361)</span></div><div class="line"><span class="comment">//	   at java.security.AccessController.doPrivileged(Native Method)</span></div><div class="line"><span class="comment">//	   at java.net.URLClassLoader.findClass(URLClassLoader.java:360)</span></div><div class="line"><span class="comment">//	   at java.lang.ClassLoader.loadClass(ClassLoader.java:424)</span></div><div class="line"><span class="comment">//	   at java.lang.ClassLoader.loadClass(ClassLoader.java:357)</span></div><div class="line"><span class="comment">//	   at java.lang.Class.forName0(Native Method)</span></div><div class="line"><span class="comment">//	   at java.lang.Class.forName(Class.java:344)</span></div><div class="line"><span class="comment">//	   at net.sephy.test.ClassLoaderTest.test(ClassLoaderTest.java:31)</span></div><div class="line"><span class="comment">//	   at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)</span></div><div class="line"><span class="comment">//	   at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)</span></div><div class="line"><span class="comment">//	   at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)</span></div><div class="line"><span class="comment">//	   at java.lang.reflect.Method.invoke(Method.java:483)</span></div><div class="line"><span class="comment">//	   at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:50)</span></div><div class="line"><span class="comment">//	   at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)</span></div><div class="line"><span class="comment">//	   at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:47)</span></div><div class="line"><span class="comment">//	   at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)</span></div><div class="line"><span class="comment">//	   at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:325)</span></div><div class="line"><span class="comment">//	   at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:78)</span></div><div class="line"><span class="comment">//	   at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:57)</span></div><div class="line"><span class="comment">//	   at org.junit.runners.ParentRunner$3.run(ParentRunner.java:290)</span></div><div class="line"><span class="comment">//	   at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:71)</span></div><div class="line"><span class="comment">//	   at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:288)</span></div><div class="line"><span class="comment">//	   at org.junit.runners.ParentRunner.access$000(ParentRunner.java:58)</span></div><div class="line"><span class="comment">//	   at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:268)</span></div><div class="line"><span class="comment">//	   at org.junit.runners.ParentRunner.run(ParentRunner.java:363)</span></div><div class="line"><span class="comment">//	   at org.junit.runner.JUnitCore.run(JUnitCore.java:137)</span></div><div class="line"><span class="comment">//	   at com.intellij.junit4.JUnit4IdeaTestRunner.startRunnerWithArgs(JUnit4IdeaTestRunner.java:117)</span></div><div class="line"><span class="comment">//	   at com.intellij.junit4.JUnit4IdeaTestRunner.startRunnerWithArgs(JUnit4IdeaTestRunner.java:42)</span></div><div class="line"><span class="comment">//	   at com.intellij.rt.execution.junit.JUnitStarter.prepareStreamsAndStart(JUnitStarter.java:253)</span></div><div class="line"><span class="comment">//	   at com.intellij.rt.execution.junit.JUnitStarter.main(JUnitStarter.java:84)</span></div><div class="line"><span class="comment">//	   at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)</span></div><div class="line"><span class="comment">//	   at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)</span></div><div class="line"><span class="comment">//	   at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)</span></div><div class="line"><span class="comment">//	   at java.lang.reflect.Method.invoke(Method.java:483)</span></div><div class="line"><span class="comment">//	   at com.intellij.rt.execution.application.AppMain.main(AppMain.java:147)</span></div></pre></td></tr></table></figure>
<h3 id="单一性机制"><a href="#单一性机制" class="headerlink" title="单一性机制"></a>单一性机制</h3><p>父加载器加载过的类不能被子加载器加载第二次(当然，我们可以实现自己的类加载器打破这种约束，<strong> 并不推荐 </strong>)。</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ClassLoader/">ClassLoader</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JVM/">JVM</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java/">Java</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-JVM内存模型" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/08/11/JVM内存模型/" class="article-date">
      <time datetime="2016-08-11T08:43:43.000Z" itemprop="datePublished">2016-08-11</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/08/11/JVM内存模型/">JVM内存模型</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p>看了下 <strong>Java8</strong> 的 (JVM规范)[<a href="https://docs.oracle.com/javase/specs/jvms/se8/jvms8.pdf]，JVM" target="_blank" rel="external">https://docs.oracle.com/javase/specs/jvms/se8/jvms8.pdf]，JVM</a> 运行时数据区(Run-Time Data Areas)是在JVM运行的时候操作系统所分配的内存区，具体可以分为: pc 寄存器(The pc Register)，Java 虚拟机栈(Java Virtual Machine Stacks)，Java 堆(Heap)，方法区(Method Area)，运行时常量池(Run-Time Constant Pool)，本地方法栈(Native Method Stacks)。</p>
<p>画了张图，大致如下(可能不是十分准确)：</p>
<div align="center"><br><img src="http://7xlm7s.com1.z0.glb.clouddn.com/JVM%E8%BF%90%E8%A1%8C%E6%97%B6%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B.png?imageView2/2/w/1000/h/500&amp;v=20160812" alt="JVM内存区域划分"><br></div>

<h4 id="pc-寄存器-The-pc-Register"><a href="#pc-寄存器-The-pc-Register" class="headerlink" title="pc 寄存器(The pc Register)"></a>pc 寄存器(The pc Register)</h4><p>JVM 支持多个线程(Thread)同时运行，每个线程都有自己的pc寄存器(程序计数器)。在任意时刻，一个 Java 虚拟机线程只会执行一个方法的 代码，这个正在被线程执行的方法称为该线程的当前方法。倘若当前执行的是 JVM 的方法，则该寄存器中保存当前执行指令的地址；倘若执行的是 native 方法，则PC寄存器中为 undefined。</p>
<h4 id="虚拟机栈-Java-Virtual-Machine-Stacks"><a href="#虚拟机栈-Java-Virtual-Machine-Stacks" class="headerlink" title="虚拟机栈(Java Virtual Machine Stacks)"></a>虚拟机栈(Java Virtual Machine Stacks)</h4><p>每个线程有一个私有的栈(JVM Stack)，随着线程的创建而创建。栈里面存着的是一种叫”栈帧”的东西，每个方法会创建一个栈帧(Frame)，栈帧中存放了局部变量表(基本数据类型和对象引用)、操作数栈、方法出口等信息。因为除了栈帧的出栈和入栈之外，Java 虚拟机栈不会 再受其他因素的影响，所以栈帧可以在堆中分配，Java 虚拟机栈所使用的内存不需要保证<br>是连续的。栈的大小可以固定也可以动态扩展。</p>
<blockquote>
<p>如果线程请求分配的栈容量超过 Java 虚拟机栈允许的最大容量,Java 虚拟机将会抛<br>出一个 <strong> StackOver owError </strong> 异常，可以通过 <strong> -Xss </strong> 来设置每个线程栈的大小。<br>如果 Java 虚拟机栈可以动态扩展，并且在尝试扩展的时候无法申请到足够的内存，<br>或者在创建新的线程时没有足够的内存去创建对应的虚拟机栈，那 Java 虚拟机将会 抛出一个 <strong> OutOfMemoryError </strong> 异常。</p>
</blockquote>
<h4 id="堆-Heap"><a href="#堆-Heap" class="headerlink" title="堆(Heap)"></a>堆(Heap)</h4><p>堆内存是 JVM 所有线程共享的部分，在虚拟机启动的时候就已经创建。所有的对象和数组都在堆上进行分配。这部分空间可通过 <strong>GC</strong> 进行回收。当申请不到空间时会抛出 <strong> OutOfMemoryError </strong>。<br>Java 堆的容量可以是固定的,也可以随着程序执行的需求动态扩展,并在不需要过<br>多空间时自动收缩。Java 堆所使用的内存不需要保证是连续的。</p>
<blockquote>
<p>如果实际所需的堆超过了自动内存管理系统能提供的最大容量,那 Java 虚拟机将会<br>抛出一个 <strong> OutOfMemoryError </strong> 异常。</p>
</blockquote>
<h4 id="方法区-Method-Area"><a href="#方法区-Method-Area" class="headerlink" title="方法区(Method Area)"></a>方法区(Method Area)</h4><p>方法区也是所有线程共享。主要用于存储类的结构信息，例如：常量池(runtime constant pool)、字段和方法数据、构造函数和普通方法的字节码内容，还包括一些 在类、实例、接口初始化时用到的特殊方法。方法区在虚拟机启动的时候创建，逻辑上属于堆的一部分，但是为了与堆进行区分，通常又叫“非堆”。</p>
<blockquote>
<p>如果方法区的内存空间不能满足内存分配请求,那么 Java 虚拟机将抛出一个<br><strong> OutOfMemoryError </strong> 异常。</p>
</blockquote>
<h4 id="运行时常量池-Run-Time-Constant-Pool"><a href="#运行时常量池-Run-Time-Constant-Pool" class="headerlink" title="运行时常量池(Run-Time Constant Pool)"></a>运行时常量池(Run-Time Constant Pool)</h4><p>运行时常量池(runtime constant pool)是class文件中每一个类或接口的常量池表(constant_pool table)的运行时表示形式，它包括了若干种不同的常量，从编译期可知的数值字面量到必须在运行期解析后才能获得的方法或字段引用。运行时常量池类似于传<br>统语言中的符号表(symbol table)，不过它存储数据的范围比通常意义上的符号表要更为广泛。每一个运行时常量池都在 Java 虚拟机的方法区中分配，在加载类和接口<br>到虚拟机后，就创建对应的运行时常量池。 </p>
<blockquote>
<p>当创建类或接口时，如果构造运行时常量池所需要的内存空间超过了方法区所能提供<br>的最大值，那么 Java 虚拟机将会抛出一个 OutOfMemoryError 异常。</p>
</blockquote>
<h4 id="本地方法栈-Native-Method-Stacks"><a href="#本地方法栈-Native-Method-Stacks" class="headerlink" title="本地方法栈(Native Method Stacks)"></a>本地方法栈(Native Method Stacks)</h4><p>Java 虚拟机实现可能会使用到传统的栈(通常称为 C stack)来支持 native 方法(指使 用 Java 以外的其他语言编写的方法)的执行，这个栈就是本地方法栈(native method stack)。</p>
<blockquote>
<p>如果本地方法栈可以动态扩展，并且在尝试扩展的时候无法申请到足够的内存，或者<br>在创建新的线程时没有足够的内存去创建对应的本地方法栈，那么 Java 虚拟机将会 抛出一个 <strong> OutOfMemoryError </strong> 异常。<br>如果线程请求分配的栈容量超过本地方法栈允许的最大容量，Java 虚拟机将会抛出一个 <strong> StackOverowError </strong> 异常。 </p>
</blockquote>

      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JVM/">JVM</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java/">Java</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-iterm2快捷键" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/08/10/iterm2快捷键/" class="article-date">
      <time datetime="2016-08-10T07:03:05.000Z" itemprop="datePublished">2016-08-10</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/08/10/iterm2快捷键/">iterm2快捷键</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <table>
<thead>
<tr>
<th style="text-align:left">快捷键</th>
<th>功能</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">⌘ + t</td>
<td>新建标签</td>
</tr>
<tr>
<td style="text-align:left">⌘ + w</td>
<td>关闭标签</td>
</tr>
<tr>
<td style="text-align:left">⌘ + 1-9</td>
<td>切换标签</td>
</tr>
<tr>
<td style="text-align:left">⌘ + →,←</td>
<td>切换标签</td>
</tr>
<tr>
<td style="text-align:left">⌘ + w</td>
<td>关闭标签</td>
</tr>
<tr>
<td style="text-align:left">⌘ + d</td>
<td>垂直分屏</td>
</tr>
<tr>
<td style="text-align:left">⌘ + ⇧ + d</td>
<td>水平分屏</td>
</tr>
<tr>
<td style="text-align:left">⌘ + ;</td>
<td>查看历史命令</td>
</tr>
<tr>
<td style="text-align:left">⌘ + ⇧ + h</td>
<td>查看剪贴板历史</td>
</tr>
<tr>
<td style="text-align:left">⌘ + f</td>
<td>查找</td>
</tr>
<tr>
<td style="text-align:left">⌃ + u</td>
<td>清除当前行</td>
</tr>
<tr>
<td style="text-align:left">⌃ + a</td>
<td>到行首</td>
</tr>
<tr>
<td style="text-align:left">⌃ + e</td>
<td>到行尾</td>
</tr>
<tr>
<td style="text-align:left">⌃ + f</td>
<td>前进</td>
</tr>
<tr>
<td style="text-align:left">⌃ + b</td>
<td>后退</td>
</tr>
<tr>
<td style="text-align:left">⌃ + p</td>
<td>上一条命令</td>
</tr>
<tr>
<td style="text-align:left">⌃ + r</td>
<td>搜索命令历史</td>
</tr>
<tr>
<td style="text-align:left">⌃ + d</td>
<td>删除当前光标的字符</td>
</tr>
<tr>
<td style="text-align:left">⌃ + h</td>
<td>删除光标之前的字符</td>
</tr>
<tr>
<td style="text-align:left">⌃ + w</td>
<td>删除光标之前的单词</td>
</tr>
<tr>
<td style="text-align:left">⌃ + k</td>
<td>删除到文本末尾</td>
</tr>
<tr>
<td style="text-align:left">⌃ + t</td>
<td>交换光标处文本</td>
</tr>
<tr>
<td style="text-align:left">⌘ + r</td>
<td>清屏1</td>
</tr>
<tr>
<td style="text-align:left">⌃ + l</td>
<td>清屏2</td>
</tr>
</tbody>
</table>
<blockquote>
<p>⌘(command)<br>⌃(ctrl)<br>⇧(shift)</p>
</blockquote>

      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MacOS/">MacOS</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/OSX/">OSX</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/iterm2/">iterm2</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-Logstash读取log4j2日志文件" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/08/09/Logstash读取log4j2日志文件/" class="article-date">
      <time datetime="2016-08-09T09:37:52.000Z" itemprop="datePublished">2016-08-09</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/08/09/Logstash读取log4j2日志文件/">Logstash读取log4j2日志文件</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p>Log4j2 日志输出格式: <strong> %d{yyyy-MM-dd HH:mm:ss,SSS} [%t] %-5level [%X{_traceId}] %logger - %msg%n </strong></p>
<p>输出示例:</p>
<blockquote>
<p>2016-08-09 15:09:03,386 [http-8080-3] INFO [854efeae-394c-48b8-aafe-fe16ec4863c2] net.sephy.filter.UserRequestLoggingFilter - {“user”:”114”, “ip”:”192.168.2.122”,”host”:”localhost”,”method”:”get”,”uri”:”/a/b/c”,”parameters”:”_=1470726543254”}<br>2016-08-09 10:20:00,386 [threadPoolTaskScheduler-3] INFO [] net.sephy.util.TaskLogger - Execute id: 2b3e223f-43f4-4222-80d1-0edaeb0fbeae finished, time used: 345<br>2015-03-23 11:11:58,666 [http-8080-4] ERROR [894c547a-9a84-4baf-960a-0e994b62b678] net.sephy.ExceptionResolver - Processing request failed<br>kafka.common.FailedToSendMessageException: Failed to send messages after 3 tries.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;at kafka.producer.async.DefaultEventHandler.handle(DefaultEventHandler.scala:90)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;at kafka.producer.Producer.send(Producer.scala:77)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;at kafka.javaapi.producer.Producer.send(Producer.scala:42)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;…<br>2015-03-23 11:11:58,666 [http-8080-4] ERROR [894c547a-9a84-4baf-960a-0e994b62b678] net.sephy.ExceptionResolver - Processing request failed<br>kafka.common.FailedToSendMessageException: Failed to send messages after 3 tries.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;at kafka.producer.async.DefaultEventHandler.handle(DefaultEventHandler.scala:90)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;at kafka.producer.Producer.send(Producer.scala:77)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;at kafka.javaapi.producer.Producer.send(Producer.scala:42)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;…</p>
</blockquote>
<h5 id="正确解析异常日志"><a href="#正确解析异常日志" class="headerlink" title="正确解析异常日志"></a>正确解析异常日志</h5><p>因为异常输出的日志会占据很多行, 为了能正确识别这些日志, 我们可以使用 <strong> muiltiline codec </strong> 或者 <strong> muiltiline filter </strong> 来处理多行输出的文本</p>
<p>multiline code 配置示例, 正则表达式是关键</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">input &#123;</div><div class="line">    file &#123;</div><div class="line">        path =&gt; &quot;/var/log/test.log&quot;</div><div class="line">        start_position =&gt; &quot;beginning&quot;</div><div class="line">        codec =&gt; multiline &#123;</div><div class="line">            pattern =&gt; &quot;(^d+serror)|(^.+Exception: .+)|(^s+at .+)|(^s+... d+ more)|(^s*Caused by:.+)&quot;</div><div class="line">            what =&gt; &quot;previous&quot;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>实际上通过日志输出格式可以发现, 每条日志输出都是以时间搓为日志起始标识, 所以更好的识别方案如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">input &#123;</div><div class="line">    file &#123;</div><div class="line">        path =&gt; &quot;/var/log/test.log&quot;</div><div class="line">        start_position =&gt; &quot;beginning&quot;</div><div class="line">        codec =&gt; multiline &#123;</div><div class="line">            pattern =&gt; &quot;^%&#123;TIMESTAMP_ISO8601&#125;&quot; # 这个正则查看以时间搓(n)作为起始的文本行, 直到匹配到下一个新的时间搓(n+1), </div><div class="line">                                               # 从 n 开始 n+1 之前的的内容, 都作为同一个日志事件(需要配合设置 negate 参数为 true)</div><div class="line">            negate =&gt; true</div><div class="line">            what =&gt; &quot;previous&quot;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>最终的 logstash.conf 配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div></pre></td><td class="code"><pre><div class="line">input &#123; </div><div class="line">    </div><div class="line">    # 读取log4j2的日志文件</div><div class="line">    # 针对 log4j2 的日志格式如下:</div><div class="line">    # %d&#123;yyyy-MM-dd HH:mm:ss,SSS&#125; [%t] %-5level [%X&#123;_traceId&#125;] %logger - %msg%n</div><div class="line">    </div><div class="line">    file &#123;</div><div class="line">        path =&gt; [&quot;/path/to/log&quot;] # 对应的日志文件路径</div><div class="line">        </div><div class="line">        stat_interval =&gt; 1 # 间隔多少秒读取</div><div class="line">        add_field =&gt; &#123; # 增加一些标记以示区分</div><div class="line">        	&quot;[@metadata][app]&quot; =&gt; &quot;your_app&quot;</div><div class="line">        	&quot;[@metadata][document_type]&quot; =&gt; &quot;your_doc_type&quot;</div><div class="line">        &#125;</div><div class="line">        codec =&gt; multiline &#123; # 当调用 log.error(&quot;message&quot;, cause) 方法是, 会输出多行日志</div><div class="line">            pattern =&gt; &quot;^%&#123;TIMESTAMP_ISO8601&#125;&quot;</div><div class="line">            negate =&gt; true</div><div class="line">            what =&gt; &quot;previous&quot;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">filter &#123;</div><div class="line">    if &quot;your_app&quot; == [@metadata][app] &#123;</div><div class="line">        grok &#123;</div><div class="line">            match =&gt; &#123;</div><div class="line">                &quot;message&quot; =&gt; &quot;\A%&#123;TIMESTAMP_ISO8601:timestamp&#125;\s+\[%&#123;NOTSPACE:thread&#125;\]\s+%&#123;LOGLEVEL:level&#125;\s+\[(%&#123;UUID:traceId&#125;)?\]\s+%&#123;JAVACLASS:logger&#125;\s+-\s+%&#123;GREEDYDATA:message&#125;(&#123;(&#123;[^&#125;]+&#125;,?\s*)*&#125;)?\s*$(?&lt;stacktrace&gt;(?m:.*))?&quot;</div><div class="line">            &#125;</div><div class="line">            overwrite =&gt; [ &quot;message&quot; ]</div><div class="line">        &#125;</div><div class="line">        mutate &#123;</div><div class="line">            remove_field =&gt; [&quot;path&quot;]</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    # 针对一些特别日志输出, 做一些个性化配置</div><div class="line">    if &quot;your_app&quot; == [@metadata][app] and &quot;net.sephy.filter.UserRequestLoggingFilter&quot; == [logger] &#123;</div><div class="line">        json &#123;</div><div class="line">    		source =&gt; &quot;message&quot;</div><div class="line">        &#125;</div><div class="line">        mutate &#123;</div><div class="line">            update =&gt; &#123; &quot;[@metadata][document_type]&quot; =&gt; &quot;access_log&quot; &#125;</div><div class="line">        &#125;</div><div class="line">    &#125; else if &quot;your_app&quot; == [@metadata][app] and &quot;net.sephy.util.TaskLogger&quot; == [logger] &#123;</div><div class="line">        mutate &#123;</div><div class="line">            update =&gt; &#123; &quot;[@metadata][document_type]&quot; =&gt; &quot;schedule_log&quot; &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">output &#123;</div><div class="line">    if &quot;your_app&quot; == [@metadata][app] &#123;</div><div class="line">        elasticsearch &#123; </div><div class="line">      		hosts =&gt; [&quot;localhost:9200&quot;]    # 请改成 对应的 elasticsearch 地址</div><div class="line">      		index =&gt; &quot;logstash-%&#123;+YYYY.MM.dd&#125;&quot;</div><div class="line">            document_type =&gt; &quot;%&#123;[@metadata][document_type]&#125;&quot;</div><div class="line">      		codec =&gt; json</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    stdout &#123; codec =&gt; rubydebug &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Log4j2/">Log4j2</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Logstash/">Logstash</a></li></ul>
    </div>

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
  
    <nav id="page-nav">
      <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">Next &raquo;</a>
    </nav>
  
</div>
      <footer id="footer">
    <div class="outer">
        <div id="footer-info">
            <div class="footer-left">
                <i class="fa fa-copyright"></i> 
                2016-2017 虾米
            </div>
            <div class="footer-right">
                <a href="http://hexo.io/" target="_blank" title="快速、简洁且高效的博客框架">Hexo</a>  Theme <a href="https://github.com/MOxFIVE/hexo-theme-yelee" target="_blank" title="简而不减 Hexo 双栏博客主题  v3.5">Yelee</a> by MOxFIVE <i class="fa fa-heart animated infinite pulse"></i>
            </div>
        </div>
        
            <div class="visit">
                
                    <span id="busuanzi_container_site_pv" style='display:none'>
                        <span id="site-visit" title="本站到访数"><i class="fa fa-user" aria-hidden="true"></i><span id="busuanzi_value_site_uv"></span>
                        </span>
                    </span>
                
                
                    <span>| </span>
                
                
                    <span id="busuanzi_container_page_pv" style='display:none'>
                        <span id="page-visit"  title="本页阅读量"><i class="fa fa-eye animated infinite pulse" aria-hidden="true"></i><span id="busuanzi_value_page_pv"></span>
                        </span>
                    </span>
                
            </div>
        
    </div>
</footer>
    </div>
    
<script data-main="/js/main.js" src="//cdn.bootcss.com/require.js/2.2.0/require.min.js"></script>

    <script>
        $(document).ready(function() {
            var iPad = window.navigator.userAgent.indexOf('iPad');
            if (iPad > -1 || $(".left-col").css("display") === "none") {
                var bgColorList = ["#9db3f4", "#414141", "#e5a859", "#f5dfc6", "#c084a0", "#847e72", "#cd8390", "#996731"];
                var bgColor = Math.ceil(Math.random() * (bgColorList.length - 1));
                $("body").css({"background-color": bgColorList[bgColor], "background-size": "cover"});
            }
            else {
                var backgroundnum = 5;
                var backgroundimg = "url(/background/bg-x.jpg)".replace(/x/gi, Math.ceil(Math.random() * backgroundnum));
                $("body").css({"background": backgroundimg, "background-attachment": "fixed", "background-size": "cover"});
            }
        })
    </script>





<div class="scroll" id="scroll">
    <a href="#" title="返回顶部"><i class="fa fa-arrow-up"></i></a>
    <a href="#comments" onclick="load$hide();" title="查看评论"><i class="fa fa-comments-o"></i></a>
    <a href="#footer" title="转到底部"><i class="fa fa-arrow-down"></i></a>
</div>
<script>
    // Open in New Window
    
        var oOpenInNew = {
            
            
            
            
            
            
             archives: ".archive-article-title", 
             miniArchives: "a.post-list-link", 
            
             friends: "#js-friends a", 
             socail: ".social a" 
        }
        for (var x in oOpenInNew) {
            $(oOpenInNew[x]).attr("target", "_blank");
        }
    
</script>

<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
  </div>
</body>
</html>